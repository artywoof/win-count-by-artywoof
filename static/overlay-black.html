<!DOCTYPE html>
<html style="background: black !important;">
<head>
    <meta charset="utf-8" />
    <title>Overlay - Black BG</title>
    <style>
        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó */
        html, body {
            background: #000000 !important;
            background-color: #000000 !important;
            background-image: none !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            overflow: hidden !important;
        }
        
        /* ‡∏õ‡∏¥‡∏î‡∏ö‡∏±‡∏á rainbow ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥ */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000000;
            z-index: 1;
        }
    </style>
</head>
<body>
    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô -->
    <div style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000000; z-index: 1;"></div>
    
    <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç -->
    <div id="overlay-content" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 72px; font-family: Arial; z-index: 10;">
        üëë0/10
    </div>
    
    <!-- Debug -->
    <div id="debug" style="position: fixed; top: 10px; left: 10px; color: lime; font-size: 12px; background: rgba(0,0,0,0.9); padding: 5px; border-radius: 3px; z-index: 10;">
        0/10 - Black BG
    </div>

    <script>
        let win = 0;
        let goal = 10;
        let showCrown = true;
        let showGoal = true;
        let lastReceived = "None";
        
        function updateDisplay() {
            const content = document.getElementById('overlay-content');
            const debug = document.getElementById('debug');
            
            let display = '';
            if (showCrown) display += 'üëë';
            display += win;
            if (showGoal) display += '/' + goal;
            
            content.textContent = display;
            debug.innerHTML = `${win}/${goal} - Black BG<br>Last: ${lastReceived}`;
            
            console.log('üìª OVERLAY: Display updated to:', display);
        }
        
        if (typeof BroadcastChannel !== 'undefined') {
            const channel = new BroadcastChannel('win-count-overlay');
            console.log('üìª OVERLAY: BroadcastChannel created');
            
            channel.onmessage = (event) => {
                console.log('üìª OVERLAY: Message received:', event.data);
                lastReceived = new Date().toLocaleTimeString();
                const data = event.data;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
                addLog(`üì• RAW DATA: ${JSON.stringify(data)}`);
                
                if (data) {
                    let changed = false;
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å field ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ
                    if (data.win !== undefined && data.win !== win) {
                        console.log(`üìª OVERLAY: Win changing from ${win} to ${data.win}`);
                        win = data.win;
                        changed = true;
                    } else if (data.win !== undefined) {
                        console.log(`üìª OVERLAY: Win same value: ${data.win}`);
                        win = data.win;
                    }
                    
                    if (data.goal !== undefined && data.goal !== goal) {
                        console.log(`üìª OVERLAY: Goal changing from ${goal} to ${data.goal}`);
                        goal = data.goal;
                        changed = true;
                    } else if (data.goal !== undefined) {
                        console.log(`üìª OVERLAY: Goal same value: ${data.goal}`);
                        goal = data.goal;
                    }
                    
                    if (data.show_crown !== undefined) {
                        showCrown = data.show_crown;
                        changed = true;
                    }
                    if (data.show_goal !== undefined) {
                        showGoal = data.show_goal;
                        changed = true;
                    }
                    
                    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö update ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                    updateDisplay();
                    console.log('üìª OVERLAY: Force updated display');
                    
                    if (changed) {
                        console.log('üìª OVERLAY: Changes detected and applied');
                    } else {
                        console.log('üìª OVERLAY: No changes but display updated anyway');
                    }
                } else {
                    console.log('üìª OVERLAY: Invalid data received');
                }
            };
            
            // Function to add log to overlay display
            function addLog(message) {
                const debug = document.getElementById('debug');
                debug.innerHTML += '<br>' + message;
            }
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            setTimeout(() => {
                channel.postMessage({ type: 'test-from-overlay', timestamp: Date.now() });
                console.log('üìª OVERLAY: Test message sent');
            }, 500);
            
            // ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            setTimeout(() => {
                channel.postMessage({ type: 'request-sync' });
                console.log('üìª OVERLAY: Initial sync requested');
            }, 100);
            
            // ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ (‡∏•‡∏î‡∏•‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            setInterval(() => {
                channel.postMessage({ type: 'request-sync' });
                console.log('üìª OVERLAY: Periodic sync request');
            }, 10000);
            
            console.log('üìª OVERLAY: Ready and listening');
        } else {
            console.error('üìª OVERLAY: BroadcastChannel not supported');
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        updateDisplay();
    </script>
</body>
</html>
